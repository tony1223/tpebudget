var _raw ={"drilldown":[{"depname":"衛生局","amount":1725238000,"num_entries":12,"cat":"衛生局主管"},{"depname":"環境保護局","amount":3757438000,"num_entries":12,"cat":"環境保護局主管"},{"depname":"中區資源回收廠","amount":291036000,"num_entries":3,"cat":"環境保護局主管"},{"depname":"南區資源回收廠","amount":433686000,"num_entries":3,"cat":"環境保護局主管"},{"depname":"地政局","amount":186237000,"num_entries":10,"cat":"地政局主管"},{"depname":"土地開發處","amount":299115000,"num_entries":8,"cat":"地政局主管"},{"depname":"鹽埕地政事務所","amount":49701000,"num_entries":6,"cat":"地政局主管"},{"depname":"新興地政事務所","amount":53806000,"num_entries":6,"cat":"地政局主管"},{"depname":"前鎮地政事務所","amount":56939000,"num_entries":6,"cat":"地政局主管"},{"depname":"楠梓地政事務所","amount":56579000,"num_entries":6,"cat":"地政局主管"},{"depname":"三民地政事務所","amount":59117000,"num_entries":6,"cat":"地政局主管"},{"depname":"鳳山地政事務所","amount":69300000,"num_entries":6,"cat":"地政局主管"},{"depname":"岡山地政事務所","amount":66241000,"num_entries":6,"cat":"地政局主管"},{"depname":"旗山地政事務所","amount":42462000,"num_entries":4,"cat":"地政局主管"},{"depname":"路竹地政事務所","amount":62845000,"num_entries":6,"cat":"地政局主管"},{"depname":"仁武地政事務所","amount":59996000,"num_entries":6,"cat":"地政局主管"},{"depname":"美濃地政事務所","amount":39386000,"num_entries":4,"cat":"地政局主管"},{"depname":"大寮地政事務所","amount":58506000,"num_entries":6,"cat":"地政局主管"},{"depname":"新聞局","amount":154684000,"num_entries":6,"cat":"新聞局主管"},{"depname":"高雄廣播電臺","amount":43474000,"num_entries":2,"cat":"新聞局主管"},{"depname":"兵役局","amount":159028000,"num_entries":5,"cat":"兵役局主管"},{"depname":"農業局","amount":1900207000,"num_entries":10,"cat":"農業局主管"},{"depname":"動物保護處","amount":153668000,"num_entries":6,"cat":"農業局主管"},{"depname":"勞工局","amount":436650000,"num_entries":11,"cat":"勞工局主管"},{"depname":"勞動檢查處","amount":95499000,"num_entries":7,"cat":"勞工局主管"},{"depname":"勞工教育生活中心","amount":47321000,"num_entries":4,"cat":"勞工局主管"},{"depname":"訓練就業中心","amount":71632000,"num_entries":5,"cat":"勞工局主管"},{"depname":"博愛職業技能訓練中心","amount":23933000,"num_entries":2,"cat":"勞工局主管"},{"depname":"捷運工程局","amount":1540345000,"num_entries":4,"cat":"捷運工程局主管"},{"depname":"消防局","amount":2105276000,"num_entries":12,"cat":"消防局主管"},{"depname":"文化局","amount":674449000,"num_entries":10,"cat":"文化局主管"},{"depname":"美術館","amount":185452000,"num_entries":2,"cat":"文化局主管"},{"depname":"圖書館","amount":425129000,"num_entries":3,"cat":"文化局主管"},{"depname":"歷史博物館","amount":79416000,"num_entries":2,"cat":"文化局主管"},{"depname":"電影館","amount":67062000,"num_entries":2,"cat":"文化局主管"},{"depname":"高雄市議會","amount":869321000,"num_entries":11,"cat":"市議會主管"},{"depname":"交通局","amount":1966578000,"num_entries":8,"cat":"交通局主管"},{"depname":"車輛行車事故鑑定委員會","amount":10314000,"num_entries":1,"cat":"交通局主管"},{"depname":"海洋局","amount":635147000,"num_entries":10,"cat":"海洋局主管"},{"depname":"都市發展局","amount":414319000,"num_entries":11,"cat":"都市發展局主管"},{"depname":"法制局","amount":67019000,"num_entries":6,"cat":"法制局主管"},{"depname":"觀光局","amount":472888000,"num_entries":8,"cat":"觀光局主管"},{"depname":"水利局","amount":5700786000,"num_entries":8,"cat":"水利局主管"},{"depname":"第二預備金","amount":500000000,"num_entries":1,"cat":"第二預備金"},{"depname":"秘書處","amount":326299000,"num_entries":6,"cat":"市政府主管"},{"depname":"主計處","amount":94842000,"num_entries":7,"cat":"市政府主管"},{"depname":"人事處","amount":157109000,"num_entries":7,"cat":"市政府主管"},{"depname":"研究發展考核委員會","amount":110789000,"num_entries":9,"cat":"市政府主管"},{"depname":"政風處","amount":54817000,"num_entries":5,"cat":"市政府主管"},{"depname":"原住民事務委員會","amount":599490000,"num_entries":6,"cat":"市政府主管"},{"depname":"客家事務委員會","amount":134743000,"num_entries":3,"cat":"市政府主管"},{"depname":"公務人力發展中心","amount":52501000,"num_entries":2,"cat":"市政府主管"},{"depname":"資訊中心","amount":73069000,"num_entries":4,"cat":"市政府主管"},{"depname":"鹽埕區公所","amount":65941000,"num_entries":3,"cat":"市政府主管"},{"depname":"鼓山區公所","amount":132556000,"num_entries":3,"cat":"市政府主管"},{"depname":"左營區公所","amount":140593000,"num_entries":3,"cat":"市政府主管"},{"depname":"楠梓區公所","amount":141559000,"num_entries":3,"cat":"市政府主管"},{"depname":"三民區公所","amount":255496000,"num_entries":3,"cat":"市政府主管"},{"depname":"新興區公所","amount":97409000,"num_entries":3,"cat":"市政府主管"},{"depname":"前金區公所","amount":69151000,"num_entries":4,"cat":"市政府主管"},{"depname":"苓雅區公所","amount":205314000,"num_entries":3,"cat":"市政府主管"},{"depname":"前鎮區公所","amount":222891000,"num_entries":4,"cat":"市政府主管"},{"depname":"旗津區公所","amount":54002000,"num_entries":4,"cat":"市政府主管"},{"depname":"小港區公所","amount":280229000,"num_entries":4,"cat":"市政府主管"},{"depname":"鳳山區公所","amount":301396000,"num_entries":3,"cat":"市政府主管"},{"depname":"林園區公所","amount":239345000,"num_entries":3,"cat":"市政府主管"},{"depname":"大寮區公所","amount":172156000,"num_entries":3,"cat":"市政府主管"},{"depname":"大樹區公所","amount":111552000,"num_entries":3,"cat":"市政府主管"},{"depname":"大社區公所","amount":73816000,"num_entries":3,"cat":"市政府主管"},{"depname":"仁武區公所","amount":105977000,"num_entries":3,"cat":"市政府主管"},{"depname":"鳥松區公所","amount":66084000,"num_entries":3,"cat":"市政府主管"},{"depname":"岡山區公所","amount":163211000,"num_entries":3,"cat":"市政府主管"},{"depname":"橋頭區公所","amount":80158000,"num_entries":3,"cat":"市政府主管"},{"depname":"燕巢區公所","amount":75653000,"num_entries":3,"cat":"市政府主管"},{"depname":"田寮區公所","amount":51408000,"num_entries":3,"cat":"市政府主管"},{"depname":"阿蓮區公所","amount":75576000,"num_entries":3,"cat":"市政府主管"},{"depname":"路竹區公所","amount":139652000,"num_entries":3,"cat":"市政府主管"},{"depname":"湖內區公所","amount":81870000,"num_entries":3,"cat":"市政府主管"},{"depname":"茄萣區公所","amount":165758000,"num_entries":3,"cat":"市政府主管"},{"depname":"永安區公所","amount":156023000,"num_entries":3,"cat":"市政府主管"},{"depname":"彌陀區公所","amount":89864000,"num_entries":3,"cat":"市政府主管"},{"depname":"梓官區公所","amount":70517000,"num_entries":3,"cat":"市政府主管"},{"depname":"旗山區公所","amount":118570000,"num_entries":3,"cat":"市政府主管"},{"depname":"美濃區公所","amount":114459000,"num_entries":3,"cat":"市政府主管"},{"depname":"六龜區公所","amount":182093000,"num_entries":3,"cat":"市政府主管"},{"depname":"甲仙區公所","amount":71230000,"num_entries":3,"cat":"市政府主管"},{"depname":"杉林區公所","amount":59590000,"num_entries":3,"cat":"市政府主管"},{"depname":"內門區公所","amount":96384000,"num_entries":3,"cat":"市政府主管"},{"depname":"市統籌","amount":7994097000,"num_entries":3,"cat":"市政府主管"},{"depname":"民政局","amount":1114968000,"num_entries":8,"cat":"民政局主管"},{"depname":"殯葬管理處","amount":585477000,"num_entries":5,"cat":"民政局主管"},{"depname":"財政局","amount":2549920000,"num_entries":12,"cat":"財政局主管"},{"depname":"高雄市稅捐稽徵處","amount":753454000,"num_entries":7,"cat":"財政局主管"},{"depname":"教育局","amount":42191239000,"num_entries":3,"cat":"教育局主管"},{"depname":"體育處","amount":561811000,"num_entries":4,"cat":"教育局主管"},{"depname":"社會教育館","amount":48784000,"num_entries":3,"cat":"教育局主管"},{"depname":"家庭教育中心","amount":21759000,"num_entries":3,"cat":"教育局主管"},{"depname":"經濟發展局","amount":1064935000,"num_entries":8,"cat":"經濟發展局主管"},{"depname":"工務局","amount":1732879000,"num_entries":6,"cat":"工務局主管"},{"depname":"新建工程處","amount":2748913000,"num_entries":3,"cat":"工務局主管"},{"depname":"養護工程處","amount":3189317000,"num_entries":8,"cat":"工務局主管"},{"depname":"違章建築處理大隊","amount":94019000,"num_entries":2,"cat":"工務局主管"},{"depname":"社會局","amount":14052485000,"num_entries":15,"cat":"社會局主管"},{"depname":"仁愛之家","amount":56342000,"num_entries":3,"cat":"社會局主管"},{"depname":"兒童福利服務中心","amount":43163000,"num_entries":2,"cat":"社會局主管"},{"depname":"無障礙之家","amount":76942000,"num_entries":2,"cat":"社會局主管"},{"depname":"長青綜合服務中心","amount":88208000,"num_entries":2,"cat":"社會局主管"},{"depname":"家庭暴力及性侵害防治中心","amount":132508000,"num_entries":4,"cat":"社會局主管"},{"depname":"警察局","amount":9752120000,"num_entries":29,"cat":"警察局主管"}],"summary":{"pagesize":1000000,"cached":true,"num_entries":563,"page":1,"currency":{"amount":"TWD"},"amount":121151707000,"cache_key":"8311c0ab057432fb04ac54847f5fc214e24c69cd","pages":1}};

var last_data = null;
function parseURL(val) {
    var result = "Not found",
        tmp = [];
    location.search
    //.replace ( "?", "" ) 
    // this is better, there might be a question mark inside
    .substr(1)
        .split("&")
        .forEach(function (item) {
        tmp = item.split("=");
        if (tmp[0] === val) result = decodeURIComponent(tmp[1]);
    });
    return result;
}
function initTreeMap() {
    $("#treemap-backbtn").hide();
    
    function setdebit(v) {
      var debit = $("#debitmask");
      debit.css({"top": v+"px", "height": (520-v)+"px", "line-height": (520-v)+"px"});
      debit.text(v+"億");
    }
    setdebit(123);
    mapforyear(2015, function(y2015){
      mapforyear(2016, function(y2016){
        var data;
        data = dataOverYears(2015, 2016, y2015, y2016);
        data = data.sort(function(a, b){
          return b.amount - a.amount;
        });
        last_data = data;
        select(null);
      });
    });    
    var kx = 1, ky = 1;
    var w = 710 - 80,
        h = 740 - 180,
        x = d3.scale.linear().range([0, w]),
        y = d3.scale.linear().range([0, h]),
        color = d3.scale.category20c(),
        root,
        node;

    var treemap = d3.layout.treemap()
        .round(false)
        .size([w, h])
        .sticky(true)
        .value(function(d) { return d.size; });

    var svg = d3.select("#treemap-root").append("div")
        .attr("class", "budget-treemap")
        .style("width", w + "px")
        .style("height", h + "px")
      .append("svg:svg")
        .attr("width", w)
        .attr("height", h)
        .attr("id", "treemap-svg")
      .append("svg:g")
        .attr("transform", "translate(.5,.5)");

    var CurrencyData = [
	  ["", "元", 1],
	  ["份","營養午餐",25],
	  ["份","營養午餐(回扣)",30],
	  ["人的","年薪",308000],
	  ["分鐘","太空旅遊",1000000],
	  ["碗","鬍鬚張魯肉飯",68],
	  ["個","便當",50],
	  ["杯","珍奶",30],
	  ["份","雞排加珍奶",60],
	  ["個","夢想家",200000000],
	  ["座","冰島",2000080000000],
    ["次","北市重陽敬老禮金",770000000],
	  ["支","iPhone5",25900],
	];

	function _num(val,divide,floats){
		return parseInt( (val/divide) * Math.pow(10,floats),10)/ Math.pow(10,floats);
	};
    function CurrencyConvert(v,idx,full) {
      if(idx==undefined) idx = 0;
      var c = CurrencyData[idx];
      v = parseInt(10000*v/c[2])/10000;
      if(v>1 && v<1000) v=parseInt(10*v)/10;
      if(v>=1000 && v<10000) v=parseInt(v/1000)+"千";
      else if(v>=10000 && v<100000000) v= parseInt(v/10000)+"萬";
      else if(v>=100000000 && v<1000000000000) v=_num(v,100000000,2)+"億";
      else if(v>=1000000000000) v=_num(v,1000000000000,2)+"兆";
      return v+(full?c[0]+c[1]:"");
    }
    var lastcell = null;
    var lockcell = null;

    function clickNode(d){
       if(lockcell && lockcell.find) lockcell.find("rect").css({"stroke": "none"});
       if(!lockcell || lockcell.get(0)!=$(this).get(0)) {
         $(this).find("rect").css({"stroke": "rgb(255,0,0)"});
         lockcell = $(this), lastcell = d;
         update_detail_amount();
         select(lastcell);

         var scope = angular.element("#BudgetItem").scope()
         scope.$apply(function() { scope.key="view3:"+d.cat+":"+d.name; });
       } else { lockcell=null; }
       if(node!=d.parent) {
         $("#treemap-backbtn").show();
         return zoom(d.parent);
       } 
    }    
    function foo(data) {
      node = root = data;

      var nodes = treemap.nodes(root)
          .filter(function(d) { return !d.children; });
      var cell = svg.selectAll("g.cell")
          .data(nodes)
        .enter().append("svg:g")
          .attr("class", "cell")
          .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
          .on("mouseover", function(d) {
             var i;
             if(lockcell || d==lastcell) return; else lastcell=d;
             update_detail_amount();
             var scope = angular.element("#BudgetItem").scope()
             scope.$apply(function() { scope.key="view3:"+d.cat+":"+d.name; });
          })
          .on("click", clickNode);
      var _k=1, _n=1;
      var _n = svg.selectAll("g.cell")[0].length;
      svg.selectAll("g.cell").filter(function(d,i) {
        if(parseInt(Math.random()*_n)==_k-1) {
          _k--;
          lastcell = d;
          update_detail_amount();
        } _n--;
      });
      cell.append("svg:rect")
          .attr("width", function(d) { return (d.dx>1?d.dx - 1:0); })
          .attr("height", function(d) { return (d.dy>1?d.dy - 1:0); })
          .style("fill", function(d) { return color(d.parent.name); });

      var texts = cell.append("svg:g").attr("class", "texts");
      texts.append("svg:text")
          .attr("class", "name")
          .attr("x", function(d) { return d.dx / 2; })
          .attr("y", function(d) { return d.dy / 2-7; })
          .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .text(function(d) { return d.name; });
      texts.append("svg:text")
          .attr("class", "amount")
          .attr("x", function(d) { return d.dx / 2; })
          .attr("y", function(d) { return d.dy / 2+7; })
          .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .text(function(d) { return CurrencyConvert(d.size, budget_unit, true); });
      texts.style("display", function(d) { return textSize(d,this,["block","none"]); });

      d3.select("#treemap-backbtn").on("click",function() { zoom(root); $("#treemap-backbtn").hide(); });
    };
    function size(d) {
      return d.size;
    }

    function count(d) {
      return 1;
    }

    var dx = 0;

    function select(cell){
      if(last_data){
        console.log(cell);
        // $("#budget-detail-depname-field").text(lastcell.name);
        // $("#budget-detail-category-field").text(lastcell.cat);

        // alt_unit = (UnitMapper.get()==0?parseInt(Math.random()*(CurrencyData.length-1))+1:0);
        // $("#budget-detail-amount-field1-value").text(
        //   UnitMapper.convert(lastcell.size) + UnitMapper.getQuantifier());
        // $("#budget-detail-amount-field1-unit").text(UnitMapper.getUnit());
        // $("#budget-detail-amount-field2").text(UnitMapper.convert(lastcell.size, alt_unit, true));

        var out = [];
        out.push("<hr /><table class='table table-bordered'>");
        // 款  項 目 節
        out.push("<tr><td class='span1'>年份</td><td class='span1'>代碼</td>",
          "<td class='span1'>款</td>",
          "<td class='span1'>項</td>",
          "<td class='span2'>目</td>",
          "<td class='span2'>名稱</td>",
          "<td class='span2'>金額</td>",
          "<td class='span2'>前一年差額</td>",
          "<td class='span2'>細節</td>",
          "</tr>");
        for(var i = 0 ; i < last_data.length;++i){
          var d = last_data[i];
          if( cell && !(cell.cat == d.topname || cell.name == d.topname) ){
            continue;
          }
          // if( cell &&  cell.cat  && d.depname != cell.name){
            // continue;
          // }
          var domID = d.code.replace(/\./gi,"-");
          out.push("<tr><td>",d.year,"</td><td>",
            d.code.split("-")[1],"</td><td>",
            d.topname,"</td><td>",
            d.depname,"</td><td>",
            d.category,"</td><td>",
            d.name,"</td><td>",
            UnitMapper.convert(d.amount, null, true),"</td>",
            "<td> ", 
              "<span style='color:",(d.change == 0 ? "black" :d.change > 0 ? "red" :"green"),"'>",
              d.amount && [(d.change > 0 ? "+" :"") , parseInt(d.change *100 * 100,10)/100 ,"%"].join("") ,
              "<br /> (約差 ",
              UnitMapper.convert(d.amount - d.last_year, null, true),")</td>",
            "<td><button  onclick=\"$('#info-",domID,
              "')[0].style.display=='none' ?$('#info-",
              domID, 
              "').show():$('#info-" , domID , "').hide(); \" class='btn'>看更多細節</button></td>",
          "</tr>",
          "<tr id='info-", domID ,"' style='display:none;'><td></td><td colspan='9'>",d.comment_html,"</td></tr>"
          );
        };
        
        out.push("</table>");
        $("#budget-change-detail").html(out.join(""));
      }
    }

    function zoom(d,init) {

      var isRoot = d.name == "root";
      if(!isRoot){
        select(d);
        console.log(d);

        // if(!init){
        //   if(window.history.pushState){
        //     window.history.pushState(null,document.title,'http://'+window.location.host+'/view3/'+(d.cat||"dep")+"/"+(d.name||""));
        //   }
        // }
      }else{
        select(null);

        // if(!init){
        //   if(window.history.pushState){
        //     // window.history.pushState(null,document.title,'http://'+window.location.host+'/view3/');
        //   }
        // }
      }
      // console.log(d);
      kx = w / d.dx, ky = h / d.dy;
      x.domain([d.x, d.x + d.dx]);
      y.domain([d.y, d.y + d.dy]);

      var t = svg.selectAll("g.cell").transition()
          .duration(750)
          .attr("transform", function(d) { return "translate(" + x(d.x) + "," + y(d.y) + ")"; });

      t.select("rect")
          .attr("width", function(d) { return (kx*d.dx>1?kx * d.dx - 1:0); })
          .attr("height", function(d) { return (ky*d.dy>1?ky * d.dy - 1:0); })

      t.select("text.name")
          .attr("x", function(d) { return (kx * d.dx / 2 ); })
          .attr("text-anchor", function(d) { 
            if(isRoot){
              return "middle";
            }
            return (kx * d.dx / 2 ) < 30?"left":"middle"; 
          })
          .attr("y", function(d) { return ky * d.dy / 2 - 7; });

      t.select("text.amount")
          .attr("x", function(d) { return kx * d.dx / 2; })
          .attr("text-anchor", function(d) { 
            if(isRoot){
              return "middle";
            }            
            return (kx * d.dx / 2 ) < 30 ?"left":"middle"; 
          })
          .attr("y", function(d) { 
            return ky * d.dy / 2 + 7; 
          });

      svg.selectAll("g.texts")
      .transition().style("display", function(d) { return textSize(d,this,["block",$(this).css("display")]);  })
      .transition().duration(250).style("opacity", function(d) { 
        return textSize(d,this,[1,1]); 
      })
      .transition().delay(250).style("display", function(d) { 
        if(!isRoot){
          return "block";
        }
        // return "block"; 
        return textSize(d,this,["block","none"]); 
      });

      node = d;
      d3.event.stopPropagation();
    }

    var unit_selector;
    var budget_unit=0;
    function textSize(d,item, values) {
        if(kx*d.dx+5 > item.childNodes[0].getComputedTextLength() 
         && kx*d.dx+5 > item.childNodes[1].getComputedTextLength()
         && ky*d.dy>20) return values[0];
        else return values[1];
    }

    $.get("http://tony1223.github.io/ks-budget-convert/output/%E6%AD%B2%E5%87%BA%E6%A9%9F%E9%97%9C%E5%88%A5%E9%A0%90%E7%AE%97%E8%A1%A8_g0v_drilldown.json",function(raw){
      var datas = parse(raw);
      foo(datas);
      var uname = null,ucat = null;
      if( (ucat = parseURL("cat")) || (uname = parseURL("name"))){
        $.each(datas.children,function(ind,data){
          if(data.name == uname){
            clickNode(data);
          }
          $.each(data.children,function(ind,data){
            if(data.name == uname){
              clickNode(data);
            }
          });
        });
      }
      $(document).ready(function() { UnitMapper.onchange(update_unit); })
    });
    


    function update_unit(idx) {
      //unit_selector=$("#unit-selector"); // move to sth like $(doc).ready
      /*
      if(budget_unit>=0) $("#unit-selector li:eq("+budget_unit+") a i").css({"visibility":"hidden"});
      if(idx==-1) {
        budget_unit = parseInt(Math.random()*CurrencyData.length);
        $("#unit-selector li:eq("+budget_unit+") a i").style("display","inline-block");
      } else if(idx==undefined) budget_unit = unit_selector.val();
      else budget_unit = idx;
      $("#unit-selector li:eq("+budget_unit+") a i").css({"visibility":"visible"});
      update_detail_amount();
      d3.selectAll("text.amount").text(function(d) {
        return CurrencyConvert(d.size, budget_unit, true);
      });*/
      update_detail_amount();
      svg.selectAll("g.texts")
      .transition().style("display", function(d) { return "block";  })
      .transition().duration(750).style("opacity", function(d) { return textSize(d,this,[1,0]); })
      .transition().delay(750).style("display", function(d) { return textSize(d,this,[$(this).css("display"),"none"]); });
    }

    function update_detail_amount() {
      if(lastcell) {
        $("#budget-detail-depname-field").text(lastcell.name);
        $("#budget-detail-category-field").text(lastcell.cat);

        alt_unit = (UnitMapper.get()==0?parseInt(Math.random()*(CurrencyData.length-1))+1:0);
        $("#budget-detail-amount-field1-value").text(
          UnitMapper.convert(lastcell.size) + UnitMapper.getQuantifier());
        $("#budget-detail-amount-field1-unit").text(UnitMapper.getUnit());
        $("#budget-detail-amount-field2").text(UnitMapper.convert(lastcell.size, alt_unit, true));

        /*alt_unit = (budget_unit==0?parseInt(Math.random()*(CurrencyData.length-1))+1:0);
        $("#budget-detail-amount-field1-value").text(
          CurrencyConvert(lastcell.size,budget_unit)+CurrencyData[budget_unit][0]);
        $("#budget-detail-amount-field1-unit").text(CurrencyData[budget_unit][1]);
        $("#budget-detail-amount-field2").text(CurrencyConvert(lastcell.size, alt_unit)+
          CurrencyData[alt_unit][0]+CurrencyData[alt_unit][1]);*/
      }
    }


}
